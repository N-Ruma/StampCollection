{% extends "base.html" %}
{% load static %}

{% block head %}
  <script src='{% static "js/script.js" %}'></script>
  <script src='{% static "js/geolocation.js" %}'></script>
  <link rel="stylesheet" href="{% static 'css/stamp_detail.css' %}">
{% endblock head %}

{% block content %}
<div class="detail-container">
  {% comment %} スタンプ獲得済み {% endcomment %}
  {% if own_stamp %}
    <div class="detail-image">
      <img src="{{ own_stamp.stamp_image.url }}" alt="{{ own_stamp }}">
    </div>
    <h2 class="detail-title">{{ own_stamp }}</h2>
    <p class="detail-description">
      {{ own_stamp.description|default:"このスポットに関する説明が入ります。" }}
    </p>
    <div class="location-info">
      <p>緯度：{{ own_stamp.latitude }}</p>
      <p>経度：{{ own_stamp.longitude }}</p>
    </div>
  {% comment %} スタンプ未獲得 {% endcomment %}
  {% elif unknown_stamp %}
    <form method="POST" action='{% url "judge" %}' enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" name="upload_image" accept="image/png, image/jpeg, image/jpg" required>
      <input type="hidden" name="stamp" value="{{ unknown_stamp }}">
      <input type="hidden" name="current_latitude" id="current_latitude" value="0.0">
      <input type="hidden" name="current_longitude" id="current_longitude" value="0.0">
      <button type="submit" onclick="get_current_position()">スタンプを獲得する!</button>
    </form>

    <div class="detail-image">
      <canvas id="canvas_{{ unknown_stamp.id }}"></canvas>
    </div>
    <h2 class="detail-title">{{ unknown_stamp }}</h2>
    <p class="detail-description">
      {{ unknown_stamp.description|default:"このスポットに関する説明が入ります。" }}
    </p>
    <div class="location-info">
      <p>緯度：{{ unknown_stamp.latitude }}</p>
      <p>経度：{{ unknown_stamp.longitude }}</p>
    </div>
  {% endif %}
</div>
{% endblock content %}

{% block redirect %}
 <div><a href="{% url 'stamp_list' %}" class="back-link">スタンプ一覧へ戻る</a></div>
{% endblock redirect %}

{% block script %}
<script>
  {% if unknown_stamp %}
    draw_image({{ unknown_stamp.id }}, "{{ unknown_stamp.stamp_image.url }}")
  {% endif %}
</script>
{% endblock script %}